status: 200
content-length: 62608
vary: X-PJAX, Accept-Encoding
x-xss-protection: 1; mode=block
x-content-type-options: nosniff
x-runtime: 0.032131
etag: "3333cd5bfed2599891e1c55785f9acb1"
x-ua-compatible: IE=Edge,chrome=1
cache-control: max-age=0, private, must-revalidate
x-served-by: b26767d88b31b8e1e88f61422786ec5e
set-cookie: logged_in=no; domain=.github.com; path=/;
 expires=Sun, 24-Sep-2034 22:21:27 GMT; secure; HttpOnly,
 _gh_sess=eyJzZXNzaW9uX2lkIjoiYzVjMDk3MmZjNjA0MjRjNTNiMTZlMTQyZjA0YTBjNGQiLCJzcHlfcmVwbyI6Ik5lbHNvbk1pbmFyL3ZlY3Rvci1yaXZlci1tYXAiLCJzcHlfcmVwb19hdCI6MTQxMTU5NzI4NywiX2NzcmZfdG9rZW4iOiJ5b3FJRUVzZlVEUHRKbGpUUFZRVThweHRWaXhYUXl6cHM4MWVoMVNjam5FPSJ9--62842725cc5410eefcd6fc8f6208248d670cbc6f;
 path=/; secure; HttpOnly
-content-encoding: gzip
x-github-request-id: 80523527:5B18:A597C64:542343E7
date: Wed, 24 Sep 2014 22:21:27 GMT
content-location: https://github.com/NelsonMinar/vector-river-map
content-security-policy: default-src *; script-src assets-cdn.github.com
 www.google-analytics.com collector-cdn.github.com;
 object-src assets-cdn.github.com;
 style-src 'self' 'unsafe-inline' 'unsafe-eval' assets-cdn.github.com;
 img-src 'self' data: assets-cdn.github.com identicons.github.com
 www.google-analytics.com collector.githubapp.com *.githubusercontent.com
 *.gravatar.com *.wp.com; media-src 'none';
 frame-src 'self' render.githubusercontent.com gist.github.com www.youtube.com
 player.vimeo.com checkout.paypal.com; font-src assets-cdn.github.com;
 connect-src 'self' ghconduit.com:25035 live.github.com uploads.github.com
 s3.amazonaws.com
strict-transport-security: max-age=31536000; includeSubdomains; preload
server: GitHub.com
x-frame-options: deny
content-type: text/html; charset=utf-8
-varied-accept-encoding: gzip, deflate





<!DOCTYPE html>
<html lang="en" class="">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    
    
    <title>NelsonMinar/vector-river-map Â· GitHub</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-144.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144.png">
    <meta property="fb:app_id" content="1401488693436528">

      <meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="NelsonMinar/vector-river-map" name="twitter:title" /><meta content="vector-river-map - Tutorial project demonstrating making a web map with vector tiles" name="twitter:description" /><meta content="https://avatars0.githubusercontent.com/u/382136?v=2&amp;s=400" name="twitter:image:src" />
<meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="https://avatars0.githubusercontent.com/u/382136?v=2&amp;s=400" property="og:image" /><meta content="NelsonMinar/vector-river-map" property="og:title" /><meta content="https://github.com/NelsonMinar/vector-river-map" property="og:url" /><meta content="vector-river-map - Tutorial project demonstrating making a web map with vector tiles" property="og:description" />

      <meta name="browser-stats-url" content="/_stats">
    <link rel="assets" href="https://assets-cdn.github.com/">
    <link rel="conduit-xhr" href="https://ghconduit.com:25035">
    
    <meta name="pjax-timeout" content="1000">

    <meta name="msapplication-TileImage" content="/windows-tile.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="selected-link" value="repo_source" data-pjax-transient>
      <meta name="google-analytics" content="UA-3769691-2">

    <meta content="collector.githubapp.com" name="octolytics-host" /><meta content="collector-cdn.github.com" name="octolytics-script-host" /><meta content="github" name="octolytics-app-id" /><meta content="80523527:5B18:A597C64:542343E7" name="octolytics-dimension-request_id" />
    <meta content="Rails, view, files#disambiguate" name="analytics-event" />

    
    
    <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">


    <meta content="authenticity_token" name="csrf-param" />
<meta content="8GAJnXxicip+pqWAOTFxblsUTwZxb8rINR04uKE2a9IaSyhu3O56QFK46xTrAYEbrAt0EeaPjbXMFH03F02fdQ==" name="csrf-token" />

    <link href="https://assets-cdn.github.com/assets/github-6571b20288f91b3129fa8ceaf85dde82a92181f5.css" media="all" rel="stylesheet" type="text/css" />
    <link href="https://assets-cdn.github.com/assets/github2-ebe4f38b0bd9d9264bec42039f307f77fc0a44dc.css" media="all" rel="stylesheet" type="text/css" />
    


    <meta http-equiv="x-pjax-version" content="3e6704edc966317cb0b89123dbfa7761">

      
  <meta name="description" content="vector-river-map - Tutorial project demonstrating making a web map with vector tiles">
  <meta name="go-import" content="github.com/NelsonMinar/vector-river-map git https://github.com/NelsonMinar/vector-river-map.git">

  <meta content="382136" name="octolytics-dimension-user_id" /><meta content="NelsonMinar" name="octolytics-dimension-user_login" /><meta content="9923928" name="octolytics-dimension-repository_id" /><meta content="NelsonMinar/vector-river-map" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="9923928" name="octolytics-dimension-repository_network_root_id" /><meta content="NelsonMinar/vector-river-map" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/NelsonMinar/vector-river-map/commits/master.atom" rel="alternate" title="Recent Commits to vector-river-map:master" type="application/atom+xml">

  </head>


  <body class="logged_out  env-production  vis-public">
    <a href="#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
    <div class="wrapper">
      
      
      
      


      
      <div class="header header-logged-out">
  <div class="container clearfix">

    <a class="header-logo-wordmark" href="https://github.com/" ga-data-click="(Logged out) Header, go to homepage, icon:logo-wordmark">
      <span class="mega-octicon octicon-logo-github"></span>
    </a>

    <div class="header-actions">
        <a class="button primary" href="/join" data-ga-click="(Logged out) Header, clicked Sign up, text:sign-up">Sign up</a>
      <a class="button signin" href="/login?return_to=%2FNelsonMinar%2Fvector-river-map" data-ga-click="(Logged out) Header, clicked Sign in, text:sign-in">Sign in</a>
    </div>

    <div class="site-search repo-scope js-site-search">
      <form accept-charset="UTF-8" action="/NelsonMinar/vector-river-map/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/NelsonMinar/vector-river-map/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
  <input type="text"
    class="js-site-search-field is-clearable"
    data-hotkey="s"
    name="q"
    placeholder="Search"
    data-global-scope-placeholder="Search GitHub"
    data-repo-scope-placeholder="Search"
    tabindex="1"
    autocapitalize="off">
  <div class="scope-badge">This repository</div>
</form>
    </div>

      <ul class="header-nav left">
          <li class="header-nav-item">
            <a class="header-nav-link" href="/explore" data-ga-click="(Logged out) Header, go to explore, text:explore">Explore</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="/features" data-ga-click="(Logged out) Header, go to features, text:features">Features</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://enterprise.github.com/" data-ga-click="(Logged out) Header, go to enterprise, text:enterprise">Enterprise</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="/blog" data-ga-click="(Logged out) Header, go to blog, text:blog">Blog</a>
          </li>
      </ul>

  </div>
</div>



      <div id="start-of-content" class="accessibility-aid"></div>
          <div class="site" itemscope itemtype="http://schema.org/WebPage">
    <div id="js-flash-container">
      
    </div>
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        
<ul class="pagehead-actions">


  <li>
      <a href="/login?return_to=%2FNelsonMinar%2Fvector-river-map"
    class="minibutton with-count star-button tooltipped tooltipped-n"
    aria-label="You must be signed in to star a repository" rel="nofollow">
    <span class="octicon octicon-star"></span>
    Star
  </a>

    <a class="social-count js-social-count" href="/NelsonMinar/vector-river-map/stargazers">
      365
    </a>

  </li>

    <li>
      <a href="/login?return_to=%2FNelsonMinar%2Fvector-river-map"
        class="minibutton with-count js-toggler-target fork-button tooltipped tooltipped-n"
        aria-label="You must be signed in to fork a repository" rel="nofollow">
        <span class="octicon octicon-repo-forked"></span>
        Fork
      </a>
      <a href="/NelsonMinar/vector-river-map/network" class="social-count">
        38
      </a>
    </li>
</ul>

        <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="mega-octicon octicon-repo"></span>
          <span class="author"><a href="/NelsonMinar" class="url fn" itemprop="url" rel="author"><span itemprop="title">NelsonMinar</span></a></span><!--
       --><span class="path-divider">/</span><!--
       --><strong><a href="/NelsonMinar/vector-river-map" class="js-current-repository js-repo-home-link">vector-river-map</a></strong>

          <span class="page-context-loader">
            <img alt="" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      <div class="repository-with-sidebar repo-container new-discussion-timeline with-full-navigation ">
        <div class="repository-sidebar clearfix">
            
<div class="sunken-menu vertical-right repo-nav js-repo-nav js-repository-container-pjax js-octicon-loaders" data-issue-count-url="/NelsonMinar/vector-river-map/issues/counts">
  <div class="sunken-menu-contents">
    <ul class="sunken-menu-group">
      <li class="tooltipped tooltipped-w" aria-label="Code">
        <a href="/NelsonMinar/vector-river-map" aria-label="Code" class="selected js-selected-navigation-item sunken-menu-item" data-hotkey="g c" data-pjax="true" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /NelsonMinar/vector-river-map">
          <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

        <li class="tooltipped tooltipped-w" aria-label="Issues">
          <a href="/NelsonMinar/vector-river-map/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /NelsonMinar/vector-river-map/issues">
            <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
            <span class="js-issue-replace-counter"></span>
            <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
</a>        </li>

      <li class="tooltipped tooltipped-w" aria-label="Pull Requests">
        <a href="/NelsonMinar/vector-river-map/pulls" aria-label="Pull Requests" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-hotkey="g p" data-selected-links="repo_pulls /NelsonMinar/vector-river-map/pulls">
            <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull Requests</span>
            <span class="js-pull-replace-counter"></span>
            <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>


    </ul>
    <div class="sunken-menu-separator"></div>
    <ul class="sunken-menu-group">

      <li class="tooltipped tooltipped-w" aria-label="Pulse">
        <a href="/NelsonMinar/vector-river-map/pulse/weekly" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="pulse /NelsonMinar/vector-river-map/pulse/weekly">
          <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped tooltipped-w" aria-label="Graphs">
        <a href="/NelsonMinar/vector-river-map/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="repo_graphs repo_contributors /NelsonMinar/vector-river-map/graphs">
          <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>
    </ul>


  </div>
</div>

              <div class="only-with-full-nav">
                
  
<div class="clone-url open"
  data-protocol-type="http"
  data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><span class="text-emphasized">HTTPS</span> clone URL</h3>
  <div class="input-group">
    <input type="text" class="input-mini input-monospace js-url-field"
           value="https://github.com/NelsonMinar/vector-river-map.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="https://github.com/NelsonMinar/vector-river-map.git" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url "
  data-protocol-type="subversion"
  data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><span class="text-emphasized">Subversion</span> checkout URL</h3>
  <div class="input-group">
    <input type="text" class="input-mini input-monospace js-url-field"
           value="https://github.com/NelsonMinar/vector-river-map" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="https://github.com/NelsonMinar/vector-river-map" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>


<p class="clone-options">You can clone with
      <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a>
      or <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <a href="https://help.github.com/articles/which-remote-url-should-i-use" class="help tooltipped tooltipped-n" aria-label="Get help on which URL is right for you.">
    <span class="octicon octicon-question"></span>
  </a>
</p>



                <a href="/NelsonMinar/vector-river-map/archive/master.zip"
                   class="minibutton sidebar-button"
                   aria-label="Download the contents of NelsonMinar/vector-river-map as a zip file"
                   title="Download the contents of NelsonMinar/vector-river-map as a zip file"
                   rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
              </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container>
          
<span id="js-show-full-navigation"></span>

<div class="repository-meta js-details-container ">
    <div class="repository-description">
      <p>Tutorial project demonstrating making a web map with vector tiles</p>
    </div>



</div>

<div class="overall-summary overall-summary-bottomless">

  <div class="stats-switcher-viewport js-stats-switcher-viewport">
    <div class="stats-switcher-wrapper">
    <ul class="numbers-summary">
      <li class="commits">
        <a data-pjax href="/NelsonMinar/vector-river-map/commits/master">
            <span class="octicon octicon-history"></span>
            <span class="num text-emphasized">
              122
            </span>
            commits
        </a>
      </li>
      <li>
        <a data-pjax href="/NelsonMinar/vector-river-map/branches">
          <span class="octicon octicon-git-branch"></span>
          <span class="num text-emphasized">
            2
          </span>
          branches
        </a>
      </li>

      <li>
        <a data-pjax href="/NelsonMinar/vector-river-map/releases">
          <span class="octicon octicon-tag"></span>
          <span class="num text-emphasized">
            2
          </span>
          releases
        </a>
      </li>

      <li>
        
          <a href="/NelsonMinar/vector-river-map/graphs/contributors" class="js-deferred-content" data-url="/NelsonMinar/vector-river-map/contributors_size">
            <span class="octicon octicon-organization"></span>
            <span class="num text-emphasized"></span>
            Fetching contributors
          </a>
      </li>
    </ul>

      <div class="repository-lang-stats">
        <ol class="repository-lang-stats-numbers">
          <li>
              <a href="/NelsonMinar/vector-river-map/search?l=javascript">
                <span class="color-block language-color" style="background-color:#f1e05a;"></span>
                <span class="lang">JavaScript</span>
                <span class="percent">81.8%</span>
              </a>
          </li>
          <li>
              <a href="/NelsonMinar/vector-river-map/search?l=bash">
                <span class="color-block language-color" style="background-color:#5861ce;"></span>
                <span class="lang">Shell</span>
                <span class="percent">10.9%</span>
              </a>
          </li>
          <li>
              <a href="/NelsonMinar/vector-river-map/search?l=python">
                <span class="color-block language-color" style="background-color:#3581ba;"></span>
                <span class="lang">Python</span>
                <span class="percent">7.3%</span>
              </a>
          </li>
        </ol>
      </div>
    </div>
  </div>

</div>

  <div class="tooltipped tooltipped-s" aria-label="Show language statistics">
    <a href="#"
     class="repository-lang-stats-graph js-toggle-lang-stats"
     style="background-color:#3581ba">
  <span class="language-color" style="width:81.8%; background-color:#f1e05a;" itemprop="keywords">JavaScript</span><span class="language-color" style="width:10.9%; background-color:#5861ce;" itemprop="keywords">Shell</span><span class="language-color" style="width:7.3%; background-color:#3581ba;" itemprop="keywords">Python</span>
    </a>
  </div>



<div class="file-navigation in-mid-page">
  <a href="/NelsonMinar/vector-river-map/find/master"
        class="js-show-file-finder minibutton empty-icon tooltipped tooltipped-s right"
        data-pjax
        data-hotkey="t"
        aria-label="Quickly jump between files">
    <span class="octicon octicon-list-unordered"></span>
  </a>
    <a href="/NelsonMinar/vector-river-map/compare" aria-label="Compare, review, create a pull request" class="minibutton primary tooltipped tooltipped-s left compare-button" aria-label="Compare &amp; review" data-pjax>
      <span class="octicon octicon-git-compare"></span>
    </a>

  
<div class="select-menu js-menu-container js-select-menu left">
  <span class="minibutton select-menu-button js-menu-target css-truncate" data-hotkey="w"
    data-master-branch="master"
    data-ref="master"
    title="master"
    role="button" aria-label="Switch branches or tags" tabindex="0" aria-haspopup="true">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button css-truncate-target">master</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax aria-hidden="true">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
      </div> <!-- /.select-menu-header -->

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div><!-- /.select-menu-tabs -->
      </div><!-- /.select-menu-filters -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item selected">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/NelsonMinar/vector-river-map/tree/master"
                 data-name="master"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text css-truncate-target"
                 title="master">master</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/NelsonMinar/vector-river-map/tree/tilestache-geometry"
                 data-name="tilestache-geometry"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text css-truncate-target"
                 title="tilestache-geometry">tilestache-geometry</a>
            </div> <!-- /.select-menu-item -->
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/NelsonMinar/vector-river-map/tree/release1.1"
                 data-name="release1.1"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text css-truncate-target"
                 title="release1.1">release1.1</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/NelsonMinar/vector-river-map/tree/release1.0"
                 data-name="release1.0"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text css-truncate-target"
                 title="release1.0">release1.0</a>
            </div> <!-- /.select-menu-item -->
        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

    </div> <!-- /.select-menu-modal -->
  </div> <!-- /.select-menu-modal-holder -->
</div> <!-- /.select-menu -->



  <div class="breadcrumb"><span class='repo-root js-repo-root'><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/NelsonMinar/vector-river-map" class="" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">vector-river-map</span></a></span></span><span class="separator"> / </span><form action="/login?return_to=%2FNelsonMinar%2Fvector-river-map" aria-label="Sign in to make or propose changes" class="js-new-blob-form tooltipped tooltipped-e new-file-link" method="post"><span aria-label="Sign in to make or propose changes" class="js-new-blob-submit octicon octicon-plus" data-test-id="create-new-git-file" role="button"></span></form></div>
</div>



  
  <div class="commit commit-tease js-details-container" >
    <p class="commit-title ">
        <a href="/NelsonMinar/vector-river-map/commit/35932191f727fdfb33a9c3190a547e26b73a5794" class="message" data-pjax="true" title="Change live map link in README">Change live map link in README</a>
        
    </p>
    <div class="commit-meta">
      <button aria-label="Copy SHA" class="js-zeroclipboard zeroclipboard-link" data-clipboard-text="35932191f727fdfb33a9c3190a547e26b73a5794" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
      <a href="/NelsonMinar/vector-river-map/commit/35932191f727fdfb33a9c3190a547e26b73a5794" class="sha-block" data-pjax>latest commit <span class="sha">35932191f7</span></a>

      <div class="authorship">
        <img alt="Nelson Minar" class="avatar" data-user="382136" height="20" src="https://avatars0.githubusercontent.com/u/382136?v=2&amp;s=40" width="20" />
        <span class="author-name"><a href="/NelsonMinar" rel="author">NelsonMinar</a></span>
        authored <time class="updated" datetime="2014-08-20T09:33:39-07:00" is="relative-time">August 20, 2014</time>

      </div>
    </div>
  </div>

  <div class="file-wrap">
    <table class="files" data-pjax>

      <tbody class=""
  data-url="/NelsonMinar/vector-river-map/file-list/master"
  data-deferred-content-error="Failed to load latest commit information.">

    <tr>
      <td class="icon">
        <span class="octicon octicon-file-directory"></span>
        <img alt="" class="spinner" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/NelsonMinar/vector-river-map/tree/master/clients" class="js-directory-link" id="fac04ca68a48af91f0290001604a2463-5a494d174c69be8d814907f2bcde8cec5c94489c" title="clients">clients</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target ">
          <a href="/NelsonMinar/vector-river-map/commit/fa6a12eb0e007d544d8356e0c282cf878ff02249" class="message" data-pjax="true" title="link in fourth client example">link in fourth client example</a>
        </span>
      </td>
      <td class="age">
        <span class="css-truncate css-truncate-target"><time datetime="2013-05-23T00:47:33Z" is="time-ago">May 22, 2013</time></span>
      </td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-directory"></span>
        <img alt="" class="spinner" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/NelsonMinar/vector-river-map/tree/master/dataprep" class="js-directory-link" id="6b07317945dd438d0df1070d537031ae-af8a7f02373539a085c96cec0983af0220d61275" title="dataprep">dataprep</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target ">
          <a href="/NelsonMinar/vector-river-map/commit/3e4d3d9d8082277383ee5b34a7c6dfd52cbf24a0" class="message" data-pjax="true" title="Don&#39;t specify a hostname for psycopg2 so it uses sockets

If you don&#39;t specify a hostname Psycopg2 will use sockets
(passwordless) instead of a TCP connection (requires un/pw) so it &quot;just
works&quot; when run as root (with a standard pg_hba.conf).">Don't specify a hostname for psycopg2 so it uses sockets</a>
        </span>
      </td>
      <td class="age">
        <span class="css-truncate css-truncate-target"><time datetime="2013-06-19T02:33:40Z" is="time-ago">June 18, 2013</time></span>
      </td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-directory"></span>
        <img alt="" class="spinner" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/NelsonMinar/vector-river-map/tree/master/server" class="js-directory-link" id="cf1e8c14e54505f60aa10ceb8d5d8ab3-c05b9ab4617b67014b50f529c6f7a3b333c0010c" title="server">server</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target ">
          <a href="/NelsonMinar/vector-river-map/commit/1b9cc0bf81d749fc03dd0cbcb2c2130260557e3e" class="message" data-pjax="true" title="UNTESTED CHANGE. Rename the &quot;geometry&quot; column to &quot;__geometry__&quot; to
match TileStache API change. See
https://github.com/NelsonMinar/vector-river-map/issues/1">UNTESTED CHANGE. Rename the "geometry" column to "__geometry__" to</a>
        </span>
      </td>
      <td class="age">
        <span class="css-truncate css-truncate-target"><time datetime="2013-09-05T23:22:34Z" is="time-ago">September 05, 2013</time></span>
      </td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="" class="spinner" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/NelsonMinar/vector-river-map/blob/master/.gitignore" class="js-directory-link" id="a084b794bc0759e7a6b77810e01874f2-1e4854c36d2d2b2ded50da9fa508a84d91619fed" title=".gitignore">.gitignore</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target ">
          <a href="/NelsonMinar/vector-river-map/commit/df0701e88db6a5e224330048071ab48219cfca7f" class="message" data-pjax="true" title="ignore NHD even if symlink">ignore NHD even if symlink</a>
        </span>
      </td>
      <td class="age">
        <span class="css-truncate css-truncate-target"><time datetime="2013-05-07T22:41:21Z" is="time-ago">May 07, 2013</time></span>
      </td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="" class="spinner" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/NelsonMinar/vector-river-map/blob/master/LICENSE.txt" class="js-directory-link" id="61e0bdf7e1b43c5c93d9488b22e04170-cb58a491fbdd4ede2a44e54b7035fae33fc1ed73" title="LICENSE.txt">LICENSE.txt</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target ">
          <a href="/NelsonMinar/vector-river-map/commit/553329097908eb0072c8ccc1b05f690db0aea7ea" class="message" data-pjax="true" title="open source license">open source license</a>
        </span>
      </td>
      <td class="age">
        <span class="css-truncate css-truncate-target"><time datetime="2013-05-07T23:20:35Z" is="time-ago">May 07, 2013</time></span>
      </td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="" class="spinner" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/NelsonMinar/vector-river-map/blob/master/README.md" class="js-directory-link" id="04c6e90faac2675aa89e2176d2eec7d8-41ced4e5f392ec699a3d4486c92b2129110c13b5" title="README.md">README.md</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target ">
          <a href="/NelsonMinar/vector-river-map/commit/35932191f727fdfb33a9c3190a547e26b73a5794" class="message" data-pjax="true" title="Change live map link in README">Change live map link in README</a>
        </span>
      </td>
      <td class="age">
        <span class="css-truncate css-truncate-target"><time datetime="2014-08-20T16:33:39Z" is="time-ago">August 20, 2014</time></span>
      </td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="" class="spinner" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/NelsonMinar/vector-river-map/blob/master/sample-13-1316-3169.json.txt" class="js-directory-link" id="c74d88370dc99baa535b1c5c240d1ee7-1fcbb3233e78b60d88434624bd2ad922515b9784" title="sample-13-1316-3169.json.txt">sample-13-1316-3169.json.txt</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target ">
          <a href="/NelsonMinar/vector-river-map/commit/2cffa3bfa97a35c3adc40a3b163880a4a96a705e" class="message" data-pjax="true" title="sample geojson tile">sample geojson tile</a>
        </span>
      </td>
      <td class="age">
        <span class="css-truncate css-truncate-target"><time datetime="2013-05-16T23:36:19Z" is="time-ago">May 16, 2013</time></span>
      </td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="" class="spinner" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/NelsonMinar/vector-river-map/blob/master/sample.jpg" class="js-directory-link" id="db77deaeeaadf94601c75dae84bb7948-89d81a01f162fdcc73654dc7588d6ac240141cce" title="sample.jpg">sample.jpg</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target ">
          <a href="/NelsonMinar/vector-river-map/commit/4281cf110cf9ad42844ecafe1be05829ecf2ed0c" class="message" data-pjax="true" title="update screenshot">update screenshot</a>
        </span>
      </td>
      <td class="age">
        <span class="css-truncate css-truncate-target"><time datetime="2013-05-20T18:58:41Z" is="time-ago">May 20, 2013</time></span>
      </td>
    </tr>
</tbody>

    </table>
  </div>


  <div id="readme" class="boxed-group flush clearfix announce instapaper_body md">
    <h3>
      <span class="octicon octicon-book"></span>
      README.md
    </h3>

    <article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-map-of-american-rivers" class="anchor" href="#map-of-american-rivers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Map of American Rivers</h1>

<h2>
<a name="user-content-a-vector-tile-demonstration-and-tutorial" class="anchor" href="#a-vector-tile-demonstration-and-tutorial" aria-hidden="true"><span class="octicon octicon-link"></span></a>A vector tile demonstration and tutorial</h2>

<p>By <a href="http://www.somebits.com/">Nelson Minar</a> <tt>&lt;<a href="mailto:nelson@monkey.org">nelson@monkey.org</a>&gt;</tt><br>
May 2013<br>
See the <a href="http://www.somebits.com/rivers/rivers-d3leaflet.html">live map</a>
and <a href="https://github.com/NelsonMinar/vector-river-map">the source code</a>.</p>

<p><a href="http://www.somebits.com/rivers/rivers-polymaps.html#9/38.4385/-121.1270"><img src="https://camo.githubusercontent.com/230a9f21e022bbd394d6d8886d7390f7d859823c/68747470733a2f2f7261772e6769746875622e636f6d2f4e656c736f6e4d696e61722f766563746f722d72697665722d6d61702f6d61737465722f73616d706c652e6a7067" alt="sample map" data-canonical-src="https://raw.github.com/NelsonMinar/vector-river-map/master/sample.jpg" style="max-width:100%;"></a></p>

<p>Many thanks to
<a href="http://bost.ocks.org/mike/">Mike Bostock</a>,
<a href="https://github.com/mojodna">Seth Fitzsimmons</a>,
<a href="http://mike.teczno.com/">Mike Migurski</a>,
and <a href="http://visuallybs.com/">Bobby Sudekum</a>
for feedback and help.</p>

<h2>
<a name="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>This project contains everything you need from start to finish to make a
vector based web map of American rivers in the contiguous 48 states.
This demonstration map is neither
particularly beautiful nor complex, but it is a complete example of how
to build a web map using tiled vector data into a web map. The source code is
open source you are encouraged to read and tinker with.
There are three parts to the project: data preparation, HTTP serving of
vector tiles, and clients that render maps.
The components integrated in this project are:</p>

<ol class="task-list">
<li>
<a href="http://www.horizon-systems.com/nhdplus/">NHDPlus</a>, the source data for river flowlines.</li>
<li>
<a href="http://postgis.refractions.net/">PostGIS</a>, a geographic database.</li>
<li>
<a href="http://tilestache.org/">TileStache</a>, a vector tile <a href="http://www.geojson.org/">GeoJSON</a> server.</li>
<li>
<a href="http://gunicorn.org/">Gunicorn</a>, a Python web server container.</li>
<li>
<a href="http://leafletjs.com/">Leaflet</a>, <a href="http://polymaps.org/">Polymaps</a>, and
<a href="http://d3js.org/">D3.js</a>, three Javascript libraries for rendering maps.</li>
</ol><p>It's a lot of pieces, but each one is pretty simple by itself. Combined
together they form a powerful open source mapping stack for
serving vector data to web browsers. You're welcome to <a href="http://www.somebits.com/rivers/rivers-polymaps.html">see the map running
live</a> on my server, but the real
point of this project is to show developers all the pieces necessary to build
their own map using vector tiles. Read on for details of how the map is
constructed and be sure to
<a href="https://github.com/NelsonMinar/vector-river-map">check out the source code</a>;
lots of comments and a focus on readability. There are also some very
detailed development notes on
<a href="http://nelsonslog.wordpress.com/category/vector-rivers/">my work journal</a>.</p>

<p>For client authors, the vector tiles are available as a service with
the URL pattern
<code>http://somebits.com:8001/rivers/{z}/{x}/{y}.json</code>.
Light use only please; the server is not provisioned for real traffic.</p>

<h2>
<a name="user-content-quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick start</h2>

<ul class="task-list">
<li>Install <a href="#server-prerequisites">required software</a>.</li>
<li>Run <code>dataprep/downloadNhd.sh</code> to download data to a directory named "NHD".</li>
<li>Run <code>dataprep/importNhd.sh</code> to bring data NHD into a PostGIS database named "rivers".</li>
<li>Run <code>serve.sh</code> from inside the <code>server</code> directory
to start TileStache in Gunicorn at <a href="http://localhost:8000/">http://localhost:8000/</a>.</li>
<li>Load <a href="http://localhost:8000/rivers/13/1316/3169.json">a sample tile on localhost</a>
to verify GeoJSON tiles are being served.</li>
<li>Run <code>clients/serverTest.py</code> to do a quick test on the server.</li>
<li>Load <code>clients/rivers-leaflet.html</code>, <code>clients/rivers-polymaps.html</code>,
<code>clients/rivers-d3.html</code>, or <code>clients/rivers-d3leaflet.html</code> to view the map.</li>
</ul><h2>
<a name="user-content-about-vector-tiles" class="anchor" href="#about-vector-tiles" aria-hidden="true"><span class="octicon octicon-link"></span></a>About vector tiles</h2>

<p>Vector tiles are an exciting, underutilized idea to make
efficient maps. Google Maps revolutioned online cartography with "slippy maps",
raster maps that are a mosaÃ¯cof PNG or JPG images. But a lot of geographic data is
intrinsically vector oriented, lines and polygons. Today many map servers
render vector data into raster images that are then served to clients.
But serving the vector data directly to the user's browser for rendering
on the client can make maps that are  more flexible and more efficient.
Mobile apps and proprietary services like Google Maps are starting to switch
to vector maps.</p>

<p>Open source vector mapping is still in the early stages. There are several
open source vector clients:
<a href="http://polymaps.org/">Polymaps</a> was an early pioneer
for browser maps,
<a href="https://code.google.com/p/mapsforge/">MapsForge</a> and
<a href="http://www.opensciencemap.org/?page_id=2">OpenScienceMap</a> are
renderers for Android, and
<a href="http://mapbox.com/blog/vector-tiles/">MapBox 2</a> is based on
<a href="https://github.com/mapbox/mapnik-vector-tile">a vector tile stack</a>.
There are few open data vector services although recently
<a href="http://wiki.openstreetmap.org/wiki/Vector_tiles">OpenStreetMap has experimented</a>
with serving <a href="http://www.openstreetmap.us/%7Emigurski/vector-datasource/">vector tiles</a>.
(See experimental clients like
<a href="http://bl.ocks.org/ZJONSSON/5529395">Ziggy Jonsson's</a>,
<a href="http://bl.ocks.org/rsudekum/5598998">Bobby Sudekum's</a>,
and <a href="http://bl.ocks.org/mbostock/5593150">Mike Bostock's</a>.)
And currently there are only a couple of open source vector tile servers.
This tutorial relies on <a href="http://tilestache.org/doc/TileStache.Goodies.VecTiles.html">TileStache's VecTiles
provider</a> to
serve our geodata.
<a href="https://github.com/mdaines/ceramic">Ceramic</a> is an alternative.</p>

<p>Tiling isn't necessary for all vector data; if the full
dataset is small it is reasonable to serve an entire vector geometry as a
single file. For example,
this tutorial maps incldues an 88kb file of US state outlines. But with
10+MB of geodata it's important to only serve visible geometry, not the
entire dataset. In addition scaling tiles to the current zoom level
allows simplification and down-sampling to pixel visibility. But tiling
requires a lot of data preparation and server setup, hence this tutorial.</p>

<p>Vector tiles are ultimately quite simple. Consider <a href="http://somebits.com:8001/rivers/13/1316/3169.json">this tile near near
Oakland</a>
(cached copy in <a href="https://github.com/NelsonMinar/vector-river-map/blob/master/sample-13-1316-3169.json.txt">sample-13-1316-3169.json.txt</a>).
The <a href="http://www.maptiler.org/google-maps-coordinates-tile-bounds-projection/">URL naming system</a>
is Google's convention for raster map tiles:
this tile is at z=13, x=1316, y=3169.
Only instead of serving a PNG image the URL serves a
<a href="http://www.geojson.org/">GeoJSON file</a> describing the geometry inside the
tile's bounding box. This example tile has 3 features in it; one for
San Lorenzo Creek, one for Sulphur Creek, and one for two other unnamed
flows in the tile.
Each feature contains a geometry, a name, a
<a href="http://water.usgs.gov/GIS/huc.html">HUC code</a> naming the watershed,
and a <a href="http://en.wikipedia.org/wiki/Strahler_Stream_Order">Strahler number</a>
characterizing the river's significance.</p>

<p>One tricky thing about vector
tiles is what to do about features that cross tiles. In this tutorial we clip
the geometry to the tile boundary and rely on the overlapping lines being
drawn to make a seamless map. It's also possible to not clip, which results in
redundant data but keeps features intact. A third option can be to clip geometry
and re-unify it on the client before rendering.</p>

<h2>
<a name="user-content-server-prerequisites" class="anchor" href="#server-prerequisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server prerequisites</h2>

<p>The following is a partial list of software you need installed on your Unix
system to generate and serve these maps. (Sorry Windows users, Unix is a
better choice for this kind of work.) I've tested with both MacOS and Ubuntu.
On the Mac, most prerequisites are available via
<a href="http://mxcl.github.io/homebrew/">Homebrew</a>; see also this
<a href="https://github.com/nvkelso/geo-how-to/wiki/Installing-Open-Source-Geo-Software:-Mac-Edition">guide to open source geo on the Mac</a>.
On Ubuntu most software is available via
<code>apt-get</code>, although PostGIS 2 from the <a href="https://wiki.ubuntu.com/UbuntuGIS">UbuntuGIS
PPA</a> is necessary. See below for
extra Ubuntu notes. Other Linux
distributions can probably install the required software via their native
package system. If the code is available on
<a href="https://pypi.python.org/pypi">PyPI</a> I prefer to install Python code with
<a href="http://www.pip-%20installer.org/en/latest/"><code>pip</code></a> rather than rely on the Mac
or Ubuntu package versions.</p>

<ul class="task-list">
<li>
<a href="http://curl.haxx.se/">curl</a> for downloading NHDPlus data from the web.</li>
<li>
<a href="http://p7zip.sourceforge.net/">p7zip</a> for unpacking NHDPlus data. Ubuntu users be sure to install <code>p7zip-full</code>.</li>
<li>
<a href="http://www.postgresql.org/">PostgreSQL</a> and <a href="http://postgis.refractions.net/">PostGIS</a> for a geospatial database.
PostgreSQL 9.1 or later and PostGIS 2 are recommended for ease of installing the PostGIS extension.</li>
<li>
<a href="http://initd.org/psycopg/">psycopg2</a> for talking to Postgres from Python.</li>
<li>shp2pgsql, part of PostGIS, for importing ESRI shapefiles into PostGIS</li>
<li>
<a href="https://github.com/kstrauser/pgdbf">pgdbf</a> for importing DBF databases into PostgreSQL. Unfortunately the Ubuntu versions prior to 0.6.2 do not have the <code>-s</code> flag needed for handling non-ASCII data. Install from
<a href="http://sourceforge.net/projects/pgdbf/files/pgdbf/">sources</a> or ensure you're
getting version 0.6.2 or later from somewhere.</li>
<li>
<a href="http://gunicorn.org/">Gunicorn</a> for a Python web app server.</li>
<li>
<a href="http://tilestache.org/">TileStache</a> for the Python web app that serves map tiles. TileStache has
an undocumented dependency on <a href="https://pypi.python.org/pypi/Shapely">Shapely</a>
that you can install via <code>pip</code>.</li>
<li>
<a href="http://docs.python-requests.org/en/latest/">requests</a> and
<a href="https://github.com/kennethreitz/grequests">grequests</a> for <code>serverTest.py</code>, a Python HTTP client test.</li>
<li>
<a href="http://www.gdal.org/">gdal</a> is the low level library for open source geo.</li>
</ul><h3>
<a name="user-content-extra-ubuntu-details" class="anchor" href="#extra-ubuntu-details" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extra ubuntu details</h3>

<p>Not quite a complete cookbook, but close:</p>

<pre><code># Add the UbuntuGIS PPA
add-apt-repository ppa:ubuntugis/ubuntugis-unstable
apt-get update

# Install needed software with apt and PIP
apt-get install git p7zip-full python-pip postgresql-server-dev-9.1 python-dev libevent-dev gdal-bin postgis
pip install psycopg2 gunicorn tilestache requests grequests shapely

# Install pgdbf from sources
Download [pgdbf source](http://sourceforge.net/projects/pgdbf/files/pgdbf/0.6.2/)
tar -Jxf pgdbf.tar.gz
cd pgdbf; ./configure; make; sudo make install

# Postgres needs to be set up with appropriate user login.
</code></pre>

<h2>
<a name="user-content-project-components" class="anchor" href="#project-components" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project components</h2>

<p>This project consists of several short scripts and configuration files to
glue together the software components. There is precious little programming
logic here, most of it is integration.</p>

<ul class="task-list">
<li><p><code>dataprep/downloadNhd.sh</code> downloads data from <a href="http://www.horizon-%0Asystems.com/nhdplus/">NHDPlus</a>, a nice repository of cleaned up National Hydrographic
Data distributed as ESRI shapefiles. This shell script takes care of
downloading the files and then extracting the specific data files we're
interested in. NHDPlus is a fantastic resource if you're interested in mapping
water in the United States. Note by default the script only downloads data
for California; edit the script if you want the entire US.</p></li>
<li>
<p><code>dataprep/importNhd.sh</code> imports the NHDPlus data into PostGIS and
prepares it for serving. This script borrows ideas from <a href="https://gist.github.com/mojodna/b1f169b33db907f2b8dd">Seth Fitzsimmons'
NHD importer</a>. Note that
detailed output is logged to a file named <code>/tmp/nhd.log.*</code>, see the first line
of script output for details. The steps this script takes are:</p>
<ol class="task-list">
<li>Create a database named <code>rivers</code>
</li>
<li>Import NHDFlowline shapefiles into a table named <code>nhdflowline</code>
</li>
<li>Import PlusFlowlineVAA DBF files into a table named <code>plusflowlinevaa</code>
</li>
<li>Run <code>processNhd.sql</code> to create a table named <code>rivers</code>
</li>
<li>Run <code>mergeRivers.py</code> to create a table named <code>merged_rivers</code>
</li>
</ol>
</li>
<li><p><code>dataprep/processNhd.sql</code> prepares the imported data to a format more tailored
to our needs. It makes a new table named <code>rivers</code> which joins
the geometry from NHDFlowline with metadata such as river name,
<a href="http://nhd.usgs.gov/nhd_faq.html#q119">reach code</a>, and
<a href="http://en.wikipedia.org/wiki/Strahler_number">Strahler number</a> from
PlusFlowlineVAA. It has about 2.7 million rows for the whole US. (NHDFlowline
has nearly 3 million rows; flowlines which have no comid in
PlusFlowlineVAA are discarded.)</p></li>
<li><p><code>dataprep/mergeRivers.py</code> optimizes the data by merging geometry. NHD data
has many tiny little rows for a single river. For efficiency
we merge geometries based on river ID and the
HUC8 portion of the reach code. The resulting <code>merged_rivers</code> table
has about 330,000 rows.
This step is complex and not strictly necessary â
TileStache can serve the geometry
in the <code>rivers</code> table directly. But the resulting GeoJSON is large and slow
to render;
merging each river into a single LineString or MultiLineString results in
vector tiles roughly one tenth the size and time to process.</p></li>
<li><p><code>server/serve.sh</code> is a simple shell script to invoke Gunicorn and the TileStache
webapp and serve it at <a href="http://localhost:8000/">http://localhost:8000/</a>.
In a real production deployment this should be replaced with a server
management framework. (It's also possible to serve TileStache via CGI, but
it's terribly slow.)</p></li>
<li><p><code>server/gunicorn.cfg.py</code> is the Gunicorn server configuration. There's very little
here in this example, Gunicorn has <a href="http://docs.gunicorn.org/en/latest/configure.html">many configuration
options</a>.</p></li>
<li><p><code>server/tilestache.cfg</code> sets up TileStache to serve a single layer named <code>rivers</code>
from the <code>merged_rivers</code> table, backed by a cache in <code>/tmp/stache</code>.
It uses the <a href="http://tilestache.org/doc/TileStache.Goodies.VecTiles.html">VecTiles
provider</a>, the
magic in TileStache that takes care of doing PostGIS queries and preparing
nicely cropped GeoJSON tiles. At this layer we start making significant
cartographic decisions.</p></li>
<li><p><code>clients/serverTest.py</code> is a simple Python client test that inspects a few
vector tiles for basic correctness and reports load times.
<code>clients/slowTiles.py</code>
is another simple test client for timing a few particularly slow
tiles for the larger US data set.</p></li>
<li><p><code>clients/rivers-leaflet.html</code>, <code>clients/rivers-polymaps.html</code>,
<code>clients/rivers-d3.html</code>, and <code>clients/rivers-d3leaflet.html</code>
are four different implementations of
Javascript map renderers. They each load vector tiles from URLs like
<code>http://localhost:8000/rivers/{z}/{x}/{y}.json</code> and render them as SVG.
Most versions also load a couple of other map layers for context: a
<a href="http://www.arcgis.com/home/item.html?id=9c5370d0b54f4de1b48a3792d7377ff2">shaded relief map from ESRI</a>
and vector outlines of US states.<br><br>The differences between these
clients are which Javascript libraries are used
to implement the map. <a href="http://leafletjs.com/">Leaflet</a> is an actively
maintained excellent Javascript map library; <code>rivers-leaflet</code> uses
vector tile support from Glen Robertson's <a href="https://github.com/glenrobertson/leaflet-tilelayer-geojson">leaflet-tilelayer-geojson
plugin</a>,
whereas <code>rivers-d3leaflet</code> uses a Leaflet/D3 hybrid
that is fast but not feature complete.
<a href="http://polymaps.org/">Polymaps</a> is an older Javascript map library that is no
longer actively maintained. Polymaps pioneered the vector tile idea and
renders vector maps very efficiently. <a href="http://d3js.org/">D3.js</a> is a
visualization toolkit with strong geographic data capabilities. The D3
implementation is more of a demo than a complete map and is heavily
borrowed from <a href="http://bl.ocks.org/mbostock/5593150">an example by Mike Bostock</a>.</p></li>
</ul><h2>
<a name="user-content-cartographic-decisions" class="anchor" href="#cartographic-decisions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cartographic decisions</h2>

<p>Most of the work in this project is plumbing, systems programming
we have to do to make the engines go. The demonstration map is deliberately
quite simple and unsophisticated. Even so, it contains a few
decisions requiring the map maker's art.</p>

<p>Most of the actual cartography is being done in Javascript, in the Leaflet and
Polymaps drawing scripts. This tutorial code does very little, mostly just drawing
blue lines in varying thicknesses. In addition
the Leaflet version has a simple popup when rivers are clicked. With the
actual vector geometry and metadata available in Javascript a lot more could
be done in the presentation; highlighting rivers, interactive filtering by
Strahler number, combination with other vector data sources, etc.</p>

<p>The map clients presented here all use the Google Mercator projection, as is
standard for web maps. But because the river data is vector oriented it's
possible to project it in other ways. For example, see
<a href="http://www.jasondavies.com/maps/us-rivers/">Jason Davies' Albers rivers map</a>.</p>

<p>Some cartographic decisions are made on the server side. The TileStache
VecTiles configuration contains an array of queries that return results at
different zoom levels. At high zoom levels (say z=4) we only return rivers
which are relatively big, those with a <a href="http://en.wikipedia.org/wiki/Strahler_number">Strahler
number</a> of 6 or higher. At finer
grained zoom levels we return more and smaller rivers. This per-zoom filtering
both limits the bandwidth used on large scale maps and prevents the display
from being overcluttered. Rendering zillions of tiny streams can be
<a href="http://www.flickr.com/photos/nelsonminar/sets/72157633504361549/detail/">quite beautiful</a>,
but also resource intensive.</p>

<p>VecTiles also simplifies the
geometry, serving only the precision needed at the zoom level. You can
see this in action if you watch it re-render as you navigate; rivers will
start to grow more bends and detail as you zoom in. TileStache does that for
us automatically.</p>

<h2>
<a name="user-content-project-ideas" class="anchor" href="#project-ideas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project ideas</h2>

<p>The map provided here is a simple tutorial demonstration. To make
this a better map, some possible directions:</p>

<ul class="task-list">
<li><p>More beautiful river rendering. The rivers here are drawn as simple blue
lines with a thickness based on the zoom level and the river's Strahler number,
a topological measure of its distance from headwaters.
The map could be made more beautiful by
<a href="http://blog.dwtkns.com/2011/generic-stream-terms/">varying the river color too</a>,
or bringing in extra information on river size such as flow rate or average
channel width. See this <a href="http://www.pacinst.org/american-rivers-a-graphic/">Pacific Institute map</a>
for an example using flow estimates from NHD's EROM_MA0001 table.</p></li>
<li><p>More thematic data. The ESRI relief tiles are a nice base map because they show the
natural relationship between terrain and river flow, but it's pretty minimal.
Why not add some ponds and lakes, or ground cover coloring,
or cities and major roads?</p></li>
<li><p>Use a better HTTP server. Gunicorn is designed to run behind a proxy like
Nginx or Apache. Not only does a proxy handle slow clients better, it can
serve appropriate caching headers and gzip the JSON output. The file
<code>server/nginx-rivers.conf</code> is how the tiles are served on the
<a href="http://www.somebits.com/rivers/rivers-polymaps.html#9/38.4385/-121.1270">live server</a>.</p></li>
<li><p>More efficient vector tiles. The code here downloads a new set of tiles for
every zoom level. But that's needlessly redundant; it's feasible to only
download new tiles every few zoom levels and trade off pixel-perfect accuracy
for smaller bandwidth.</p></li>
<li><p>Convert to TopoJSON for smaller encoding. Even without shared topology
<a href="https://github.com/mbostock/topojson">TopoJSON</a>
encoding can be significantly smaller than equivalent GeoJSON. See
<a href="https://github.com/mbostock/us-rivers">Mike Bostock's experiments</a>
converting the entire river network to one giant TopoJSON file.</p></li>
<li><p>Measure and improve client render time. The D3 version of the client shows that
rendering can happen very fast. Unfortunately Leaflet's GeoJSON rendering is pretty
slow and Polymaps somewhere in the middle. Some quality time with Chrome
Developer Tools could help figure out where to optimize Leaflet, or maybe the
<code>lib/TileLayer.d3_geoJSON.js</code> library could be extended to support all the
features of a Leaflet tile layer.</p></li>
<li><p>WebGL or Canvas clients. All three Javascript clients in this tutorial render
via SVG. That's a natural choice for vector data but it can be slow, particularly
on mobile browsers. WebGL is a very interesting option; see
<a href="http://mike.teczno.com/notes/gl-solar-webgl-openstreetmap.html">Migurski's experiments</a>
with WebGL and vector maps.</p></li>
<li><p>Alternate projections. The spherical mercator we use for web maps is a reasonable
compromise, but other projections can be interesting. See
<a href="http://www.jasondavies.com/maps/us-rivers/">Jason Davies' Albers rivers map</a>,
<a href="http://www.jasondavies.com/maps/raster/">Jason's canvas raster reprojection</a>,
and <a href="http://bl.ocks.org/mbostock/5446416">Mike Bostock's WebGL raster reprojection</a>.</p></li>
<li><p>Extend data coverage to Alaska, HawaiÊ»i, and other countries.
<a href="http://www.naturalearthdata.com/downloads/10m-physical-vectors/10m-rivers-lake-centerlines/">Natural Earth</a>
is a good place to start. It also has links to other sources like
<a href="http://ccm.jrc.ec.europa.eu/php/index.php?action=view&amp;id=23">Europe's CCM2</a>.</p></li>
</ul><h2>
<a name="user-content-conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h2>

<p>The <a href="https://github.com/NelsonMinar/vector-river-map">vector river map</a>
lays out all the components required to make an open source
vector map, from downloading the data to preparing it in a database
to serving tiles on the Web to rendering those tiles in the browser. If
this tutorial was helpful to you or you have any suggestions or questions,
please feel free to email the author at
<a href="mailto:nelson@monkey.org"><tt>nelson@monkey.org</tt></a>. I'm looking forward
to seeing what others are inspired to do!</p></article>
  </div>


        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="http://developer.github.com">API</a></li>
      <li><a href="http://training.github.com">Training</a></li>
      <li><a href="http://shop.github.com">Shop</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/about">About</a></li>

    </ul>

    <a href="/" aria-label="Homepage">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
    </a>

    <ul class="site-footer-links">
      <li>&copy; 2014 <span title="0.03121s from github-fe131-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="/site/terms">Terms</a></li>
        <li><a href="/site/privacy">Privacy</a></li>
        <li><a href="/security">Security</a></li>
        <li><a href="/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-suggester-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="fullscreen-contents js-fullscreen-contents js-suggester-field" placeholder=""></textarea>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w"
      aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-x flash-close js-ajax-error-dismiss" aria-label="Dismiss error"></a>
      Something went wrong with that request. Please try again.
    </div>


      <script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/frameworks-dce52d0cc1884b841d65bad8688285872c2747ee.js" type="text/javascript"></script>
      <script async="async" crossorigin="anonymous" src="https://assets-cdn.github.com/assets/github-d6ce0ace23bd92a2a04a2cca2d5350ee307827f1.js" type="text/javascript"></script>
      
      
        <script async src="https://www.google-analytics.com/analytics.js"></script>
  </body>
</html>

